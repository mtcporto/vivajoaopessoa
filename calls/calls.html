<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebRTC Meet</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/webrtc-adapter/8.1.2/adapter.min.js" integrity="sha512-l40eBFtXx+ve5RryIELC3y6/OM6Nu89mLGQd7fg1C93tN6XrkC3supb+/YiD/Y+B8P37kdJjtG1MT1kOO2VzxA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
        html {
            color-scheme: light dark;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background: white;
            color: black;
        }
        body, h1, h2 {
            margin: 0;
        }
        
        h1, h2 {
            font-weight: 400;
        }
        h1 {
    font-size: 1.5rem;
    grid-column: 1 / -1; /* Garante que o título ocupe toda a largura do grid */
}
        h2 {
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }
        video {
            width: 800px;
            margin: 0 auto;
            display: block;
            transform: scaleX(-1); /* Flip horizontal */
        }

        .grid {
  display: grid;
  grid-template-columns: minmax(0, 1fr) minmax(0, 1fr); 
  gap: 1rem;
  align-items: start; 
}

.video-container {
  display: flex; 
  flex-direction: column;
  align-items: center;
  width: 100%; 
  margin: 0 auto; 
}

.controls-and-info { /* Removed the nested selector */
  display: flex;
  flex-direction: row; /* Align items horizontally */
  align-items: center;
  gap: 10px;
  width: 100%; 
}

        #local-video, 
        #remote-video {
            width: 100%; 
            margin: 0; 
        }

        .controls {
    margin-top: 10px;
    display: flex; /* Use flexbox for horizontal alignment */
    justify-content: center; /* Center the buttons horizontally */
    align-items: center;
}

#room-info,
.device-settings {
    text-align: left;
    margin-top: 10px;  
    width: 50%;                                           
}

.device-settings {
    display: flex;
    align-items: center;
    gap: 5px;
    margin-top: 10px;
    flex-direction: row;
    justify-content: flex-end
}

.btn-group {
    display: flex;
    align-items: center; 
}

.btn-group > .dropdown-toggle {
  border-top-right-radius: 0;
  border-bottom-right-radius: 0;
}

.btn-group > .dropdown-toggle-split {
  height: 38px; 
  padding: 0.375rem 0.75rem; 
  border-top-left-radius: 0;
  border-bottom-left-radius: 0;
}
.device-settings .btn-group { 
  display: flex;          
  align-items: center;   
}

.device-settings .btn-group .btn {
  flex: 1;           
}

.btn-secondary {
    color: #fff;
}

.control-button .fas {
    color: inherit; /* Inherit color from the parent button */
}

        .control-button {
            margin: 5px;
            padding: 10px;
            font-size: 16px;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .control-button.btn-danger {
            color: white;
            background-color: #dc3545;
        }
        @media (max-width: 500px) {
  .grid {
    grid-template-columns: minmax(0, 1fr);
  }
  video {
    width: 100%;
  }
}
        .config-section {
            text-align: left;
        }
        .config-label {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        .config-label i {
            margin-right: 5px;
        }
    </style>
</head>
<body>

<div class="container text-center mt-5">
    <h1 id="room-name">WebRTC Meet</h1> <div class="grid">
        <div class="video-container">
            <video id="local-video" autoplay muted></video>
            <div class="controls-and-info">
                <div id="room-info"></div>
                <div class="controls mt-3">
          <button id="toggle-audio" class="btn btn-secondary control-button"><i class="fas fa-microphone"></i></button>
          <button id="toggle-video" class="btn btn-secondary control-button"><i class="fas fa-video"></i></button>
          <button id="leave-room" class="btn btn-danger control-button"><i class="fas fa-phone"></i></button>
      </div>
    </div>
    <div class="device-settings"> 
      <div class="btn-group">
        <button class="btn btn-secondary btn-sm control-button" type="button"><i class="fas fa-microphone"></i></button>
        <button type="button" class="btn btn-sm btn-secondary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">
          <span class="visually-hidden">Toggle Microphone</span>
        </button>
        <ul class="dropdown-menu" id="audio-input-select"></ul>
      </div>
      <div class="btn-group">
        <button class="btn btn-secondary btn-sm control-button" type="button"><i class="fas fa-volume-up"></i></button>
        <button type="button" class="btn btn-sm btn-secondary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">
          <span class="visually-hidden">Toggle Headphone</span>
        </button>
        <ul class="dropdown-menu" id="audio-output-select"></ul>
      </div>
      <div class="btn-group">
        <button class="btn btn-secondary btn-sm control-button" type="button"><i class="fas fa-video"></i></button>
        <button type="button" class="btn btn-sm btn-secondary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">
          <span class="visually-hidden">Toggle Video</span>
        </button>
        <ul class="dropdown-menu" id="video-input-select"></ul>
      </div>
    </div>
  </div>
  
        <div class="video-container">
            <video id="remote-video" autoplay></video>
            <div class="controls mt-3">...</div> </div>
        </div>
    </div>
</div>




    <script type="module">
        const toggleAudioButton = document.getElementById('toggle-audio');
        const toggleVideoButton = document.getElementById('toggle-video');
        const leaveRoomButton = document.getElementById('leave-room');
        const audioInputSelect = document.getElementById('audio-input-select');
        const audioOutputSelect = document.getElementById('audio-output-select');
        const videoInputSelect = document.getElementById('video-input-select');
        const roomInfoElement = document.getElementById('room-info');
        let audioEnabled = true;
        let videoEnabled = true;
        let localStream;

        function updateRoomInfo() {
            const currentTime = new Date().toLocaleTimeString();
            const roomName = window.location.search.split('=')[1] || 'unknown';
            roomInfoElement.textContent = `${currentTime} | ${roomName}`;
        }

        async function initializeLocalStream() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                const localVideoElement = document.getElementById('local-video');
                localVideoElement.srcObject = stream;
                return stream;
            } catch (error) {
                console.error('Erro ao obter o fluxo de mídia local:', error);
            }
        }

        async function getDeviceSettings() {
            try {
                const devices = await navigator.mediaDevices.enumerateDevices();
                const audioInputDevices = devices.filter(device => device.kind === 'audioinput');
                const audioOutputDevices = devices.filter(device => device.kind === 'audiooutput');
                const videoInputDevices = devices.filter(device => device.kind === 'videoinput');

                audioInputDevices.forEach(device => {
                    const option = document.createElement('li');
                    const link = document.createElement('a');
                    link.href = '#';
                    link.className = 'dropdown-item';
                    link.textContent = device.label || `Dispositivo de entrada de áudio ${audioInputDevices.indexOf(device)}`;
                    option.appendChild(link);
                    audioInputSelect.appendChild(option);
                });

                audioOutputDevices.forEach(device => {
    const option = document.createElement('li');
    const link = document.createElement('a');
    link.href = '#';
    link.className = 'dropdown-item';
    link.textContent = device.label || `Dispositivo de saída de áudio ${audioOutputDevices.indexOf(device)}`;
    option.appendChild(link);
    audioOutputSelect.appendChild(option);
});

videoInputDevices.forEach(device => {
    const option = document.createElement('li');
    const link = document.createElement('a');
    link.href = '#';
    link.className = 'dropdown-item';
    link.textContent = device.label || `Dispositivo de entrada de vídeo ${videoInputDevices.indexOf(device)}`;
    option.appendChild(link);
    videoInputSelect.appendChild(option);
});
            } catch (error) {
                console.error('Erro ao obter as configurações de dispositivo:', error);
            }
        }

        initializeLocalStream()
            .then(stream => {
                localStream = stream;

                toggleAudioButton.addEventListener('click', () => {
    audioEnabled = !audioEnabled;
    localStream.getAudioTracks().forEach(track => track.enabled = audioEnabled);
    
    // Toggle button styles (add/remove classes)
    if (audioEnabled) {
        toggleAudioButton.classList.remove('btn-danger');
        toggleAudioButton.classList.add('btn-secondary');
    } else {
        toggleAudioButton.classList.remove('btn-secondary');
        toggleAudioButton.classList.add('btn-danger');
    }

    // Update icon
    toggleAudioButton.querySelector('i').className = audioEnabled ? 'fas fa-microphone' : 'fas fa-microphone-slash';
});

toggleVideoButton.addEventListener('click', () => {
    videoEnabled = !videoEnabled;
    localStream.getVideoTracks().forEach(track => track.enabled = videoEnabled);

    // Toggle button styles (add/remove classes)
    if (videoEnabled) {
        toggleVideoButton.classList.remove('btn-danger');
        toggleVideoButton.classList.add('btn-secondary');
    } else {
        toggleVideoButton.classList.remove('btn-secondary');
        toggleVideoButton.classList.add('btn-danger');
    }

    // Update icon
    toggleVideoButton.querySelector('i').className = videoEnabled ? 'fas fa-video' : 'fas fa-video-slash';
});


                leaveRoomButton.addEventListener('click', () => {
                    if (localStream) {
                        localStream.getTracks().forEach(track => track.stop());
                    }
                    // Redirecionar para a página inicial ou fazer outras ações necessárias
                });

                getDeviceSettings();
                updateRoomInfo();
                setInterval(updateRoomInfo, 60000); // Atualiza a hora a cada minuto
            })
            .catch(error => {
                console.error('Erro ao inicializar o fluxo de mídia local:', error);
            });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>